<!--pages/dream-detail/dream-detail.wxml-->
<view class="container">
  <!-- æ¢¦æƒ³å›¾ç‰‡ -->
  <view class="dream-header">
    <image class="dream-image" src="{{dream.image_url || '/images/default-dream.png'}}" mode="aspectFill"></image>
    <view class="header-overlay">
      <text class="dream-title">{{dream.title}}</text>
    </view>
  </view>

  <!-- AI æ¶ˆæ¯ -->
  <view class="ai-message-section">
    <view class="ai-avatar">ğŸ¤–</view>
    <view class="ai-bubble">
      <text class="ai-text">{{aiMessage}}</text>
    </view>
  </view>

  <!-- è¿›åº¦ä¿¡æ¯ -->
  <view class="progress-section card">
    <view class="progress-header">
      <text class="progress-percent">{{progress}}%</text>
      <text class="progress-status">{{progress >= 100 ? 'å·²å®Œæˆ' : 'è¿›è¡Œä¸­'}}</text>
    </view>
    
    <progress-bar progress="{{progress}}" animated="{{true}}" showMilestone="{{true}}" height="{{20}}" />
    
    <view class="amount-detail">
      <view class="amount-row">
        <text class="label">å·²å­˜é‡‘é¢</text>
        <text class="value primary">{{currentAmount}}</text>
      </view>
      <view class="amount-row">
        <text class="label">ç›®æ ‡é‡‘é¢</text>
        <text class="value">{{targetAmount}}</text>
      </view>
      <view class="amount-row">
        <text class="label">è¿˜éœ€</text>
        <text class="value">{{remainingAmount}}</text>
      </view>
    </view>
  </view>

  <!-- æ¢¦æƒ³åŸå›  -->
  <view class="reason-section card" wx:if="{{dream.reason}}">
    <view class="section-title">ğŸ’­ ä¸ºä»€ä¹ˆæƒ³è¦</view>
    <text class="reason-text">{{dream.reason}}</text>
  </view>

  <!-- æ“ä½œæŒ‰é’® -->
  <view class="action-buttons">
    <button class="btn btn-primary" bindtap="showUpdate" wx:if="{{progress < 100}}">æ›´æ–°è¿›åº¦</button>
    <button class="btn btn-primary" bindtap="completeDream" wx:if="{{progress >= 100}}">æ ‡è®°å®Œæˆ</button>
    <button class="btn btn-secondary" bindtap="sharePoster">ç”Ÿæˆæµ·æŠ¥</button>
  </view>

  <!-- æ›´æ–°è¿›åº¦å¼¹çª— -->
  <view class="modal" wx:if="{{showUpdateModal}}" catchtap="hideUpdate">
    <view class="modal-content" catchtap="">
      <view class="modal-title">æ›´æ–°è¿›åº¦</view>
      <view class="modal-body">
        <text class="modal-label">æœ¬æ¬¡å­˜å…¥é‡‘é¢ï¼ˆå…ƒï¼‰</text>
        <input 
          class="modal-input" 
          type="digit"
          placeholder="è¯·è¾“å…¥é‡‘é¢"
          value="{{updateAmount}}"
          bindinput="onUpdateAmountInput"
        />
      </view>
      <view class="modal-footer">
        <button class="modal-btn cancel" bindtap="hideUpdate">å–æ¶ˆ</button>
        <button class="modal-btn confirm" bindtap="submitUpdate">ç¡®å®š</button>
      </view>
    </view>
  </view>
</view>
